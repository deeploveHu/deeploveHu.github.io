---
layout: post
title:  "Qt学习(06)--数据库操作"
categories: Qt
tags:  Qt
author: bloglink
---

* content
{:toc}

Qt 提供了 QSqlTableModel 类来封装 sql 语句，可以很方便的与 model/view 架构进行整合。



## 一 基本操作
### 1.1 整表查询

    model = new QSqlTableModel(this,db);
    model->setTable("test");
    model->setEditStrategy(QSqlTableModel::OnManualSubmit);
    model->select(); //选取整个表的所有行

    view = new QTableView(this);
    view->setModel(model);
    view->show();

简单几行代码就实现了整个数据表的显示，不得不说对小规模数据库来说实在是太方便了

### 1.2 条件查询

    model->setFilter(QObject::tr("name= %1").arg(name)); //根据姓名进行筛选
    model->select(); //显示结果

### 1.3 添加/修改记录

    int rowNum = model->rowCount();//获得表的行数
    int id = 10;
    model->insertRow(rowNum); //添加一行
    model->setData(model->index(rowNum,0),id);
    model->submitAll(); //可以直接提交

### 1.4 删除一行记录

    int curRow = ui->tableView->currentIndex().row();//获取选中的行
    model->removeRow(curRow);//删除该行
    model->submitAll(); //在数据库中删除该行

### 1.5 删除多行记录

    selections = view->selectionModel(); //返回当前的选择模式
    QModelIndexList selecteds = selections->selectedIndexes(); //返回所有选定的模型项目索引列表
    foreach (QModelIndex index, selecteds) {
        int row = index.row(); //删除所有被选中的行
        model->removeRow(row);
    }
    model->submitAll();

### 1.6 事务操作

    model->database().transaction();//开始事务操作
    model->submitAll();

## 结语

QSqlTableModel还有很多功能，目前只使用到一小部分，待使用熟练后再与大家分享
