---
layout: post
title:  "Qt学习(05)--数据库操作"
categories: Qt
tags:  Qt
author: bloglink
---

* content
{:toc}

Qt 提供了 QtSql 模块来提供平台独立的基于 SQL 的数据库操作。下面以 QSqlite 为例说明一下Qt数据库的基本操作。



## 一 加入sql模块

默认情况下，QtSql 是作为 Qt 的一个模块提供的。为了使用有关数据库的类，我们必须早 .pro 文件中添加这么一句：

    QT += sql

## 二 查找可用驱动

我们可以通过

    QSqlDatabase::drivers();

获取系统中所有可用的数据库驱动的名字。我们只能使用出现在列表中的驱动。

## 三 打开数据库

打开sqlite数据库的代码如下

    QSqlDatabase db = QSqlDatabase::addDatabase("QSQLITE"，"test");  //使用sqlite数据库驱动,连接名为test以区分其他连接    
    db.setDatabaseName("test.db");  //之前建立的数据库   
    bool ok = db.open();  //尝试连接数据库
    if (!ok) {
      qDebug() << db.lastError().databaseText()
    }   

## 四 基本操作

### 4.1 创建表

    QSqlQuery query(db);
    query.exec("create table if not exists test (id int primary key, name text, password text)");

### 4.2 插入数据

    QSqlQuery query(db);
    query.exec("insert into test values(null,link,123456)");//使用自增ID：id为null

    或者

    QSqlQuery query(db);
    query.prepare("insert into test values(?,?,?)");
    query.binValue(0,null);
    query.binValue(1,"link");
    query.binValue(2,"123456")
    query.exec();

### 4.3 删除数据

    QSqlQuery query(db);
    query.exec("delete from test where id=1");

### 4.4 修改数据

    QSqlQuery query(db);
    query.exec("update test set name=blog where id=2");

### 4.5 查询数据

    QSqlQuery query(db);
    query.exec("select name from test where id=1");
    query.next();
    qDebug() << query.value(0).toString();

### 4.6 清空数据

    QSqlQuery query(db);
    query.exec("delete from test");

### 4.7 删除表

    QSqlQuery query(db);
    query.exec("drop table test");

## 结语

  因为数据库至今没有一个通用查询方法，所以不可能提供一种通用的数据库的操作语句。Qt 提供了 QSqlTableModel 类来封装 sql 语句，可以很方便的与 model/view 架构进行整合。后续会继续分享 QSqlTableModel 的基本操作
